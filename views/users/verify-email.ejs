<% layout("/layouts/boilerplate") %>

<style>
  .otp-input {
    width: 45px;
    height: 55px;
    text-align: center;
    font-size: 24px;
    margin: 0 5px;
    border-radius: 5px;
  }
</style>

<div class="row mt-3">
  <div class="col-md-6 offset-md-3">
    <h2 class="text-center">Email Verification</h2>
    <form id="otpForm" action="/signup/verify-email" method="POST" class="mb-4 mt-4">
      <div class="mb-3 text-center">
        <label for="otp" class="form-label">Enter OTP</label>
        <div class="d-flex justify-content-center">
          <% for(let i = 0; i < 6; i++) { %>
            <input type="text" class="form-control otp-input" maxlength="1" name="otp[]" required>
          <% } %>
        </div>
      </div>

      <p class="text-center text-muted">
        This OTP is valid for the next 10 minutes. Please enter it soon.
        <br>
        Donâ€™t forget to check your spam or junk folder if you don't see the OTP email.
      </p>

      <!-- Hidden submit button for fallback -->
      <button type="submit" class="btn btn-dark primary-btn d-none">Verify OTP</button>
    </form>

    <div class="text-center d-flex justify-content-center align-items-center">
        <p class="m-0">Didn't receive the OTP?</p>
        <form action="/signup/resend-otp" method="POST" class="mb-0">
          <button type="submit" class="btn btn-link text-decoration-none fw-semibold p-0" style="margin-bottom: 2px; margin-left: 6px;">Resend OTP</button>
        </form>
    </div>

    <p class="text-center mt-3">
        If you're still having trouble, please contact support for assistance.
    </p>
  </div>
</div>

<script>
    const inputs = document.querySelectorAll(".otp-input");
    const form = document.getElementById("otpForm");
  
    inputs[0].focus();
  
    inputs.forEach((input, index) => {
      input.addEventListener("input", (e) => {
        const value = input.value;
        if (value.length === 1 && index < inputs.length - 1) {
          inputs[index + 1].focus();
        }
  
        if ([...inputs].every(inp => inp.value)) {
          form.submit();
        }
      });
  
      input.addEventListener("keydown", (e) => {
        if (e.key === "Backspace" && !input.value && index > 0) {
          inputs[index - 1].focus();
        }
      });
  
      // PASTE HANDLER
      input.addEventListener("paste", (e) => {
        e.preventDefault();
        const paste = (e.clipboardData || window.clipboardData).getData("text").trim();
        if (!/^\d{6}$/.test(paste)) return; // only allow 6-digit numeric
  
        paste.split("").forEach((char, i) => {
          if (inputs[i]) {
            inputs[i].value = char;
          }
        });
  
        if ([...inputs].every(inp => inp.value)) {
          form.submit();
        }
      });
    });
</script>  